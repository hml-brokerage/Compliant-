# Render Deployment Guide - Quick Reference

This guide provides a quick reference for deploying INsuretrack to Render using the included `render.yaml` blueprint.

## What's Configured

The `render.yaml` file in the repository root defines a complete deployment blueprint that includes:

1. **Backend API** (`insuretrack-backend`)
   - Node.js web service
   - Express.js REST API
   - Health check endpoint at `/health`
   - Auto-scaling with free tier support

2. **Frontend Static Site** (`insuretrack-frontend`)
   - React + Vite static site
   - SPA routing configured
   - Optimized production build

## Quick Deploy Steps

### 1. One-Click Deployment

1. Go to [Render Dashboard](https://render.com/)
2. Click **New** → **Blueprint**
3. Connect your GitHub repository
4. Select branch to deploy (e.g., `main`)
5. Click **Apply**

Render will automatically:
- Create both frontend and backend services
- Build and deploy both applications
- Generate a secure JWT secret for the backend
- Provide URLs for both services

### 2. Configure Environment Variables

After deployment, configure the following:

#### Backend Service (`insuretrack-backend`)

**Required:**
```bash
JWT_SECRET=<auto-generated-by-render>  # Already set
NODE_ENV=production                     # Already set
FRONTEND_URL=https://insuretrack-frontend.onrender.com  # Update with your actual URL
```

**Optional (for email functionality):**
```bash
# Microsoft 365
SMTP_HOST=smtp.office365.com
SMTP_PORT=587
SMTP_USER=your.email@yourdomain.com
SMTP_PASS=your-password
SMTP_FROM=your.email@yourdomain.com
SMTP_SECURE=false
SMTP_REQUIRE_TLS=true

# OR Gmail
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your.email@gmail.com
SMTP_PASS=your-16-char-app-password
SMTP_FROM=your.email@gmail.com
SMTP_REQUIRE_TLS=true
```

#### Frontend Service (`insuretrack-frontend`)

**Required:**
```bash
VITE_API_BASE_URL=https://insuretrack-backend.onrender.com  # Use your actual backend URL
```

### 3. Update CORS Settings

1. Get your frontend URL from Render dashboard
2. Update backend `FRONTEND_URL` environment variable
3. Save changes (triggers automatic redeploy)

### 4. Verify Deployment

#### Test Backend Health
```bash
curl https://insuretrack-backend.onrender.com/health
# Expected: {"success":true,"data":{"status":"ok"},"timestamp":"..."}
```

#### Test Frontend
1. Visit your frontend URL
2. Should NOT see "Backend not configured" warning
3. Login with: `admin` / `INsure2026!`

## Service Details

### Backend Service Configuration

```yaml
Type: Web Service
Runtime: Node.js
Build Command: npm install
Start Command: npm start
Root Directory: backend
Health Check: /health
```

**Environment Variables:**
- `PORT`: Auto-set by Render
- `NODE_ENV`: production
- `JWT_SECRET`: Auto-generated secure random string
- `FRONTEND_URL`: Must be set manually
- `SMTP_*`: Optional email configuration

### Frontend Service Configuration

```yaml
Type: Static Site
Runtime: Static
Build Command: node build.js
Publish Directory: dist
```

**Environment Variables:**
- `VITE_API_BASE_URL`: Must be set manually

## Important Notes

### Free Tier Limitations
- Backend spins down after 15 minutes of inactivity
- First request after spin-down may be slow (10-30 seconds)
- In-memory data resets on restart
- For production, consider:
  - Paid tier (always-on instances)
  - External database (PostgreSQL/MongoDB)
  - File storage service (S3/Cloudinary)

### Service URLs
- Backend URL format: `https://insuretrack-backend.onrender.com`
- Frontend URL format: `https://insuretrack-frontend.onrender.com`
- Custom domains can be configured in service settings

### Auto-Deploy
- Services auto-deploy on git push to connected branch
- Manual deploys available in dashboard
- Rollback to previous deploys available

## Troubleshooting

### Backend Won't Start
**Check:**
- Build logs for errors
- Environment variables are set
- `backend/package.json` has `start` script
- Health check path is `/health`

**Solution:**
```bash
# Verify health endpoint locally
cd backend
npm install
npm start
# In another terminal:
curl http://localhost:3001/health
```

### Frontend Shows "Backend Not Configured"
**Check:**
- `VITE_API_BASE_URL` is set in frontend environment
- Backend URL is correct (no trailing slash)
- Backend service is running

**Solution:**
1. Go to frontend service → Environment
2. Add/update `VITE_API_BASE_URL`
3. Value: `https://insuretrack-backend.onrender.com`
4. Save (triggers redeploy)

### CORS Errors
**Check:**
- `FRONTEND_URL` in backend matches actual frontend URL
- No trailing slashes in URLs

**Solution:**
1. Go to backend service → Environment
2. Update `FRONTEND_URL` to exact frontend URL
3. Save (triggers redeploy)

### Email Not Sending
**Check:**
- SMTP environment variables are set in backend
- Email credentials are valid
- SMTP server allows connections from Render IPs

**Solution:**
See [EMAIL_SETUP.md](./EMAIL_SETUP.md) for detailed configuration

## Manual Deployment (Alternative)

If you prefer not to use the blueprint:

### Deploy Backend Manually
1. New → Web Service
2. Connect GitHub repo
3. Root Directory: `backend`
4. Build Command: `npm install`
5. Start Command: `npm start`
6. Add environment variables

### Deploy Frontend Manually
1. New → Static Site
2. Connect GitHub repo
3. Build Command: `node build.js`
4. Publish Directory: `dist`
5. Add environment variables

## Additional Resources

- [Complete Deployment Guide](./DEPLOY.md) - Full deployment instructions for all platforms
- [Email Setup Guide](./EMAIL_SETUP.md) - Configure email notifications
- [Backend Connection Setup](./BACKEND_CONNECTION_SETUP.md) - Fix connection issues
- [Production Deployment Fix](./PRODUCTION_DEPLOYMENT_FIX.md) - Common deployment problems
- [Render Documentation](https://render.com/docs) - Official Render docs
- [Render Blueprint Spec](https://render.com/docs/blueprint-spec) - Blueprint configuration reference

## Quick Commands

```bash
# Test backend locally
cd backend && npm install && npm start

# Test frontend locally
npm install && npm run dev

# Test health endpoint (local)
curl http://localhost:3001/health

# Test health endpoint (production)
curl https://insuretrack-backend.onrender.com/health

# Generate secure JWT secret (for manual setup)
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

## Login Credentials

Default admin account:
- Username: `admin`
- Password: `INsure2026!`

## Support

For issues with this deployment:
1. Check service logs in Render dashboard
2. Review this guide and [DEPLOY.md](./DEPLOY.md)
3. Check [PRODUCTION_DEPLOYMENT_FIX.md](./PRODUCTION_DEPLOYMENT_FIX.md) for common issues
4. Test backend health endpoint
5. Verify environment variables are set correctly
